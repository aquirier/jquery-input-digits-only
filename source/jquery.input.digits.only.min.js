/*
* jQuery Input Digits Only Plugin
* Version: 1.0.0.
* Release Date: 2012-12-29.
* Copyright 2012, Aleksey Kislitsyn, Quantum Art, S-Pb.
*/

(function(e){e.fn.digitsOnly=function(t){if(!(this instanceof e)||this.get(0)==null||typeof this.get(0)!="object"||this.get(0).tagName==null||typeof this.get(0).tagName=="undefined"||this.get(0).tagName.toLowerCase()!=="input"||this.get(0).type.toLowerCase()!=="text")return;var n=e(this.get(0));var r=0;var i=null;var s=false;var o=null;var u=null;var a={start:0,end:0};var f=[8,9,35,36,37,39,46];var l={maximum:"maximum",toMaxLength:"toMaxLength"};var c={parseCurrentValToNumber:function(t){var r=e.trim(n.val());if(t===true)r=r.replace(/ /g,"");return c.fixValueWithRegExp(r)},fixValueWithRegExp:function(e){var t=e.match(i);return t[1]?t[1]:""},getInputContentSelection:function(){var e=n.get(0);if(e.setSelectionRange)return e.value.substr(e.selectionStart,e.selectionEnd-e.selectionStart);else if(document.selection&&document.selection.createRange)return document.selection.createRange().text},hasInputContentSelection:function(){return c.getInputContentSelection().length>0},setInputContentSelection:function(){var e=n.get(0);if(e.setSelectionRange){e.selectionStart=0;e.selectionEnd=e.value.length}else if(e.createTextRange){var t=e.createTextRange();t.moveStart("character",0);t.collapse();t.moveEnd("character",e.value.length);t.select()}},saveBeforePasteSelectionIndexes:function(){var e=n.get(0);if(e.setSelectionRange){a.start=e.selectionStart;a.end=e.selectionEnd}else if(document.selection&&document.selection.createRange){var t=document.selection.createRange();var r=t.text.length;t.moveStart("character",-e.value.length);a.start=t.text.length-r;a.end=t.text.length}},restoreBeforePasteSelection:function(){var e=n.get(0);if(e.setSelectionRange){e.selectionStart=a.start;e.selectionEnd=a.end}else if(e.createTextRange){var t=e.createTextRange();t.moveStart("character",a.start);t.collapse();t.moveEnd("character",a.end-a.start);t.select()}},processAfterPasteVal:function(t){if(t!=l.maximum&&t!=l.toMaxLength){c.restoreBeforePasteSelection();return}var i=n.val();var s=u.substr(0,a.start);var o=u.substr(a.end);var f="";if(o.length>0){var h=i.lastIndexOf(o);f=i.substr(a.start,h-a.start)}else f=i.substr(a.start);f=c.fixValueWithRegExp(e.trim(f));var p=t==l.maximum?r-s.length:r-(s.length+o.length);f=p<=0?"":f.substr(0,p);var d=s+f+o;d=d.substr(0,r);n.val(d);a.start+=f.length;a.end=a.start;c.restoreBeforePasteSelection()}};var h={init:function(t){if(t.maxLength==null)return;r=parseInt(t.maxLength);if(isNaN(r)||r<1)return;i=new RegExp("^(\\d{1,"+r+"})?.*");n.focus(function(){s=true;o=e.trim(n.val());n.val(c.parseCurrentValToNumber(t.applySplitSpaces))});n.blur(function(){var i=e.trim(n.val());while(i.length>0&&i.charAt(0)==="0"&&i!=="0")i=i.substr(1);if(i==""){n.val(o);return}var s=i.substr(0,r);n.val(t.applySplitSpaces===true?h.applySplitSpaces(s):s);if(t.callback&&typeof t.callback==="function")t.callback(s,n)});n.keydown(function(e){for(var t=0;t<f.length;t++){if(f[t]==e.which)return true}var i=n.val();if(i.length>r){i=i.substr(0,r);n.val(i)}if(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105){if(e.shiftKey)return false;if(c.hasInputContentSelection())return true;else return i.length<r}if(e.ctrlKey&&(e.which==65||e.which==67||e.which==86||e.which==88))return true;return false});n.mouseup(function(e){if(s&&t.selectValueOnFocus===true){s=false;c.setInputContentSelection()}});n.bind("drop dragover",function(e){e.preventDefault()});n.bind("paste",function(e){u=n.val();c.saveBeforePasteSelectionIndexes();setTimeout(function(){c.processAfterPasteVal(t.pasteMode)},0);return t.pasteMode==l.maximum||t.pasteMode==l.toMaxLength});var a=c.parseCurrentValToNumber(t.applySplitSpaces);if(t.applySplitSpaces===true&&a.length>0)n.val(h.applySplitSpaces(a));else n.val(a);if(t.executeCallbackOnInit===true&&a.length>0&&t.callback&&typeof t.callback==="function")t.callback(a,n)},applySplitSpaces:function(e){var t=3;var n=" ";var r=[];e=e.toString();var i=parseInt(e.length/t);for(var s=1;s<=i;s++)r.push(n+e.substr(e.length-s*t,t));if(e.length>i*t)r.push(n+e.substr(0,e.length-i*t));r.reverse();var o="";var u=o.concat.apply(o,r);return u.substr(1)}};if(typeof t==="object"||!t)return h.init.apply(this,arguments);else if(h[t])return h[t].apply(this,Array.prototype.slice.call(arguments,1))}})(jQuery)